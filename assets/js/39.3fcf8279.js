(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{424:function(s,a,t){"use strict";t.r(a);var e=t(2),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("前言")]),s._v(" "),t("p",[s._v("本篇是 Liunx 的服务配置笔记系列第二篇, 这一篇将具体介绍 Red Hat Liunx 下 SSH 服务的安全配置。所谓 SSH 就是加密的数据传输, 但是使用其的默认配置并不是安全的, 所以还需要对其进行详细的配置")])]),s._v(" "),t("h2",{attrs:{id:"配置文件的位置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件的位置"}},[s._v("#")]),s._v(" 配置文件的位置")]),s._v(" "),t("p",[s._v("主配置文件: "),t("strong",[s._v("/etc/ssh/sshd_config")])]),s._v(" "),t("h2",{attrs:{id:"服务的启动与停止"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务的启动与停止"}},[s._v("#")]),s._v(" 服务的启动与停止")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("SSH 的服务名并不叫做 "),t("code",[s._v("ssh")]),s._v(" , 而是 "),t("code",[s._v("sshd")]),s._v(" 。"),t("br"),s._v("\n修改配置文件过后一定要重启 "),t("code",[s._v("sshd")]),s._v(" 服务。")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" sshd status        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" sshd start         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" sshd stop          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暂停")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" sshd restart       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"安全配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安全配置"}},[s._v("#")]),s._v(" 安全配置")]),s._v(" "),t("h3",{attrs:{id:"修改端口号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改端口号"}},[s._v("#")]),s._v(" 修改端口号")]),s._v(" "),t("p",[t("code",[s._v("Default Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Port 22")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("配置文件中将其注释掉, 则采用默认的端口 22, 我们可以修改它。去掉 # , 修改成我们想要的端口号。")])]),s._v(" "),t("p",[t("code",[s._v("Example Configuration:")]),s._v(" "),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-1.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h4",{attrs:{id:"使用客户端进行验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用客户端进行验证"}},[s._v("#")]),s._v(" 使用客户端进行验证")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("验证之前, 请重启服务。默认是允许 root 用户登录的, 以下测试例子是使用 root 用户登录的。")])]),s._v(" "),t("p",[s._v("使用默认端口连接, "),t("code",[s._v("Connection Format:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("userName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("若端口不对则会显示")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ssh: connect to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(": Connection refused\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("Example Connection:")]),s._v(" "),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-2.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("p",[s._v("使用配置端口连接, "),t("code",[s._v("Connection Format:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("userName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("连接成功则会显示")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Last login: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("date"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" from "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("Example Connection:")]),s._v(" "),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-3.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h3",{attrs:{id:"禁止-root-用户登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#禁止-root-用户登录"}},[s._v("#")]),s._v(" 禁止 root 用户登录")]),s._v(" "),t("p",[t("code",[s._v("Default Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PermitRootLogin yes")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("默认情况下是允许 root 用户登录的, 是十分不安全, 毕竟 root 用户权限太大了。我们可以去除 #, 将 yes 修改成 no, 这就禁止了 root 用户登录。")]),s._v(" "),t("p",[t("code",[s._v("Example Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("PermitRootLogin no\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-4.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h4",{attrs:{id:"使用客户端进行验证-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用客户端进行验证-2"}},[s._v("#")]),s._v(" 使用客户端进行验证")]),s._v(" "),t("p",[s._v("验证之前, 请重启服务。我们已经禁止 root 用户登录了, 以下测试例子仍然使用 root 用户进行验证。")]),s._v(" "),t("p",[s._v("由于之前配置过端口号, 这时候就要使用配置的端口号了, "),t("code",[s._v("Connection Format:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("使用 "),t("code",[s._v("exit")]),s._v(" 可以退出当前的连接, 退出成功将会显示")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Connection to "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" closed\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("Example Connection:")]),s._v(" "),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-5.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h3",{attrs:{id:"禁止空密码登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#禁止空密码登录"}},[s._v("#")]),s._v(" 禁止空密码登录")]),s._v(" "),t("p",[t("code",[s._v("Default Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PermitEmptyPasswords no")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("默认情况下, SSH 已经禁止了使用空密码登录系统, 即使配置文件中将其注释掉。如果被设置成 yes, 则就是不安全的, 我们可以修改成 no。")]),s._v(" "),t("p",[t("code",[s._v("Example Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("PermitEmptyPasswords no\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-6.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h4",{attrs:{id:"使用客户端进行验证-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用客户端进行验证-3"}},[s._v("#")]),s._v(" 使用客户端进行验证")]),s._v(" "),t("p",[s._v("验证之前, 请重启服务。我们已经禁止 root 用户登录了, 以下测试我们将使用普通用户。注意: 使用普通用户之前, 先确保服务端是有该用户的。")]),s._v(" "),t("p",[s._v("由于之前配置过端口号, 这时候就要使用配置的端口号了, "),t("code",[s._v("Connection Format:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("userName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果是第一次连接的话, 会提示是否保存密钥信息, 输入 "),t("code",[s._v("yes")]),s._v(" 就好。")]),s._v(" "),t("p",[t("code",[s._v("Example Connection:")]),s._v(" "),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-7.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("p",[s._v("断开连接, 我们尝试使用空密码连接, 只需回车就好")]),s._v(" "),t("p",[t("code",[s._v("Example Connection:")]),s._v(" "),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-8.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h3",{attrs:{id:"设置必需使用密码登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置必需使用密码登录"}},[s._v("#")]),s._v(" 设置必需使用密码登录")]),s._v(" "),t("p",[t("code",[s._v("Default Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PasswordAuthentication yes")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("默认的配置就是需要使用密码登录的, 即使它是注释的。若遇到配置值为 no 的, 一定要修改成 yes。")]),s._v(" "),t("p",[t("code",[s._v("Example Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("PasswordAuthentication "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"使用客户端进行验证-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用客户端进行验证-4"}},[s._v("#")]),s._v(" 使用客户端进行验证")]),s._v(" "),t("p",[s._v("前面已经验证过了, 这里不再重复")]),s._v(" "),t("h3",{attrs:{id:"设置仅允许密钥登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置仅允许密钥登录"}},[s._v("#")]),s._v(" 设置仅允许密钥登录")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("注意密钥登录是与密码登录是不一样的。只允许密钥登录的时候必须要把允许密码登录的选项禁用。")])]),s._v(" "),t("p",[t("code",[s._v("For Example:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("PasswordAuthentication no\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("接下来就是将下图所示的注释去掉, 就好了"),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-16.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h4",{attrs:{id:"免密码登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#免密码登录"}},[s._v("#")]),s._v(" 免密码登录")]),s._v(" "),t("p",[s._v("主机生成密钥对（包含公钥和私钥）")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ssh-keygen -t rsa -P "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("把本地主机的公钥复制到远程主机的 "),t("code",[s._v("authorized_keys")]),s._v(" 文件上")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ssh-copy-id "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"限制登录失败之后重试次数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#限制登录失败之后重试次数"}},[s._v("#")]),s._v(" 限制登录失败之后重试次数")]),s._v(" "),t("p",[t("code",[s._v("Default Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MaxAuthTries 6")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("默认情况下可以重试 6 次, 如果你觉得这个不合理, 当然可以修改它。同理将 # 去除, 将 6 修改成我们想要的次数。")]),s._v(" "),t("p",[t("code",[s._v("Example Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("MaxAuthTries "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-9.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h4",{attrs:{id:"使用客户端进行验证-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用客户端进行验证-5"}},[s._v("#")]),s._v(" 使用客户端进行验证")]),s._v(" "),t("p",[s._v("验证之前, 请重启服务。之前我们在服务器上新建了一个用户, 那么我们将用这个用户进行连接。")]),s._v(" "),t("p",[s._v("当我们输入错误的密码时, 则会显示")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Permission denied, please try again.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("当我们最后一次输入错误的密码时, 则会显示")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Permission denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("publickey,gssapi-with-mic,password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("Example Connection:")]),s._v(" "),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-10.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h3",{attrs:{id:"设置多长时间没有成功连接上-就断线"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置多长时间没有成功连接上-就断线"}},[s._v("#")]),s._v(" 设置多长时间没有成功连接上, 就断线")]),s._v(" "),t("p",[t("code",[s._v("Default Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LoginGraceTime 2m")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("默认的等待时间为 2 分钟, 如果没有单位将以秒作为单位, 可用的单位分别为 h, m、s。我们可以根据需求修改, 当然是越短越安全。")]),s._v(" "),t("p",[t("code",[s._v("Example Configuration:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("LoginGraceTime 10s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-11.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h4",{attrs:{id:"使用客户端进行验证-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用客户端进行验证-6"}},[s._v("#")]),s._v(" 使用客户端进行验证")]),s._v(" "),t("p",[s._v("验证之前, 请重启服务。之前我们在服务器上新建了一个用户, 那么我们仍然使用用这个用户进行连接。")]),s._v(" "),t("p",[s._v("我们可以输入一个错误的密码, 在等待一段时间, 按下回车, 则会显示")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Connection closed by "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("Example Connection:")]),s._v(" "),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-12.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h3",{attrs:{id:"设置白名单和黑名单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置白名单和黑名单"}},[s._v("#")]),s._v(" 设置白名单和黑名单")]),s._v(" "),t("p",[s._v("默认配置中是没有白名单和黑名单这个选项的, 我们可以自己添加上去。多个用户之间必须使用空格分割。同理, 用户组也一样。")]),s._v(" "),t("p",[t("code",[s._v("白名单")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("AllowUsers "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("userName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("userName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nAllowGroups groupName1 groupName2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("code",[s._v("黑名单")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("DenyUsers "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("userName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("userName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nDenyGroups groupName1 groupName2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("code",[s._v("Example Configuration:")]),s._v(" "),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-13.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h4",{attrs:{id:"使用客户端进行验证-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用客户端进行验证-7"}},[s._v("#")]),s._v(" 使用客户端进行验证")]),s._v(" "),t("p",[s._v("验证之前, 请重启服务。由于白名单与黑名单效果是一致的, 这里只提供白名单的验证测试。注意: 服务器上依然需要新建测试用户（包含设置密码, 否则, 不能登录）。")]),s._v(" "),t("p",[s._v("这时候, 我们就需要输入正确的密码。")]),s._v(" "),t("p",[t("code",[s._v("Example Connection:")]),s._v(" "),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/liunx-ssh-14.png",alt:"SSH 服务安全配置"}})]),s._v(" "),t("h3",{attrs:{id:"限制-ip-登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#限制-ip-登录"}},[s._v("#")]),s._v(" 限制 IP 登录")]),s._v(" "),t("h4",{attrs:{id:"方法一"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法一"}},[s._v("#")]),s._v(" 方法一")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("/etc/hosts.allow")]),s._v(" 中添加 SSH 登录的 ip 或者网段, "),t("code",[s._v("For Example:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("sshd:192.168.1.2:allow        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip 地址")]),s._v("\nsshd:192.168.1.0/24:allow     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网段")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("在 "),t("code",[s._v("/etc/hosts.deny")]),s._v(" 中添加不允许 SSH 登录的 IP, "),t("code",[s._v("For Example:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("sshd:ALL                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ALL 表示除了上面允许的,其他的 ip 都拒绝登录")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"方法二"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法二"}},[s._v("#")]),s._v(" 方法二")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("iptables")]),s._v(" , "),t("code",[s._v("For Example:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -A INPUT -p tcp -s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.2 --destination-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j ACCEPT\niptables -A INPUT -p tcp --destination-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j DROP\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"方法三"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法三"}},[s._v("#")]),s._v(" 方法三")]),s._v(" "),t("p",[s._v("修改 sshd 主配置文件 "),t("code",[s._v("/etc/ssh/sshd_config")]),s._v(" , "),t("code",[s._v("For Example:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("AllowUsers test@192.168.1.2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);