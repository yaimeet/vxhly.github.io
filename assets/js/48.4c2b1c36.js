(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{433:function(s,a,t){"use strict";t.r(a);var e=t(2),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("前言")]),s._v(" "),t("p",[s._v("本系列笔记又是 Liunx 学习系列教程的一大步, 本系列学习笔记记录 RedHat 系统的安全加固。本篇笔记是记录用户和文件的权限（主要是特殊权限）, 加强系统的防御能力")])]),s._v(" "),t("h2",{attrs:{id:"主要的介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主要的介绍"}},[s._v("#")]),s._v(" 主要的介绍")]),s._v(" "),t("p",[s._v("Linux 文件系统的安全主要是通过设置文件的权限来实现的。每一个 Linux 的文件或目录, 都有 3 组属性, 分别定义文件或目录的所有者, 用户组和其他人的使用权限（ "),t("code",[s._v("只读")]),s._v(" 、 "),t("code",[s._v("可写")]),s._v(" 、 "),t("code",[s._v("可执行")]),s._v(" 、 "),t("code",[s._v("允许 SUID")]),s._v(" 、 "),t("code",[s._v("允许 SGID")]),s._v(" 等）。特别注意, 权限为 "),t("code",[s._v("SUID")]),s._v(" 和 "),t("code",[s._v("SGID")]),s._v(" 的可执行文件, 在程序运行过程中, 会给进程赋予所有者的权限, 如果被黑客发现并利用就会给系统造成危害。")]),s._v(" "),t("h2",{attrs:{id:"查找同时存在-suid-和-sgid-的文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查找同时存在-suid-和-sgid-的文件"}},[s._v("#")]),s._v(" 查找同时存在 SUID 和 SGID 的文件")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("find")]),s._v(" 命令")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -xdev -perm  -6000\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("举例, 普通用户无法直接 vi 修改 "),t("code",[s._v("/etc/passwd")]),s._v(" 文件, 但却可以通过 "),t("code",[s._v("passwd")]),s._v(" 命令来修改自身的密码。这时就利用了 "),t("code",[s._v("/bin/passwd")]),s._v(" 的 SUID 的权限。")]),s._v(" "),t("p",[s._v("如果一个程序被设置成了 "),t("code",[s._v("S")]),s._v(" 位标志, 那么普通用户就可以以 root 身份来运行这个程序。对系统安全性有较大不利影响, 所以应禁止所有不必要的 "),t("code",[s._v("SUID/SGID")]),s._v(" 程序。")]),s._v(" "),t("p",[s._v("修改部分系统文件的 SUID 和 SGID 的权限:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /usr/bin/chage\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /usr/bin/gpasswd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /usr/bin/wall\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /usr/bin/chfn\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /usr/bin/chsh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /usr/bin/newgrp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /usr/bin/write\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /usr/sbin/usernetctl\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /bin/mount\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /bin/umount\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a-s /sbin/netreport\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"find-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#find-命令"}},[s._v("#")]),s._v(" find 命令")]),s._v(" "),t("p",[s._v("选项解释")]),s._v(" "),t("ul",[t("li",[t("strong",[t("code",[s._v("-perm <权限数值>")])]),s._v(" => 查找符合指定的权限数值的文件或目录；")]),s._v(" "),t("li",[t("strong",[t("code",[s._v("-xdev")])]),s._v(" => 将范围局限在先行的文件系统中；")]),s._v(" "),t("li",[t("code",[s._v("find -perm mode")]),s._v(" => 表示严格匹配, 也就是你的文件权限位转换成对应的十进制数字与 mode 一模一样, 那么匹配成功, 需要注意的是如果 mode 给的数字不足 3 位, 那么前面自动添 0 (严格的说是不足 4 位, 原因就是前面所说的 "),t("code",[s._v("SetUID")]),s._v(" , "),t("code",[s._v("SetGID")]),s._v(" ）")]),s._v(" "),t("li",[t("code",[s._v("find -perm -mode")]),s._v(" => 表示模糊查询, 也就是说你的文件权限位转换成对应的十进制数字被 mode 包含, 就会被搜索出来")]),s._v(" "),t("li",[t("code",[s._v("find -perm +mode")]),s._v(" => 与 "),t("code",[s._v("-mode")]),s._v(" 的区别是 "),t("code",[s._v("+mode")]),s._v(" 只需其中的任意一个 1 的部分被匹配, "),t("code",[s._v("-mode")]),s._v(" 是所有 1 的部分都必须被匹配, 同样 "),t("code",[s._v("+mode")]),s._v(" 也不管 0 位")])]),s._v(" "),t("h2",{attrs:{id:"文件的默认权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件的默认权限"}},[s._v("#")]),s._v(" 文件的默认权限")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("umask")]),s._v(" 指定当前用户创建文件夹和文件的默认权限属性")]),s._v(" "),t("ul",[t("li",[s._v("若使用者建立为 "),t("code",[s._v("文件")]),s._v(" , 则预设 "),t("code",[s._v("没有可执行 ( x ) 项目")]),s._v(" , 亦即只有 "),t("code",[s._v("rw")]),s._v(" 这两个项目, 也就是最大为 "),t("code",[s._v("666")]),s._v(" , 即权限为 "),t("code",[s._v("-rw-rw-rw-")])]),s._v(" "),t("li",[s._v("若使用者建立为 "),t("code",[s._v("目录")]),s._v(" , 则由于 "),t("code",[s._v("x")]),s._v(" 与是否可以进入此目录有关, 因此预设为所有权限均开放, 亦即为 "),t("code",[s._v("777")]),s._v(" , 即权限为 "),t("code",[s._v("drwxrwxrwx")])])]),s._v(" "),t("h3",{attrs:{id:"修改默认权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改默认权限"}},[s._v("#")]),s._v(" 修改默认权限")]),s._v(" "),t("p",[s._v("主要修改配置文件 "),t("code",[s._v("/etc/profile")]),s._v(" 、 "),t("code",[s._v("/etc/bashrc")]),s._v(" 、 "),t("code",[s._v("/etc/csh.login")]),s._v(" 、 "),t("code",[s._v("/etc/csh.cshrc")])]),s._v(" "),t("ul",[t("li",[s._v("生成目录的权限为 "),t("code",[s._v("777-002=775")]),s._v(" , 即 "),t("code",[s._v("drwxrwxr-x")])]),s._v(" "),t("li",[s._v("生成文件的权限为 "),t("code",[s._v("666-002=664")]),s._v(" , 即 "),t("code",[s._v("-rw-rw-r--")])])]),s._v(" "),t("p",[t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("umask")]),s._v(" 002\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("生成目录的权限为 "),t("code",[s._v("777-022=755")]),s._v(" , 即 "),t("code",[s._v("drwxrwxr-x")])]),s._v(" "),t("li",[s._v("生成文件的权限为 "),t("code",[s._v("666-022=644")]),s._v(" , 即 - "),t("code",[s._v("rw-r--r--")])])]),s._v(" "),t("p",[t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("umask")]),s._v(" 022\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("不要单纯的进行数字加减"),t("br"),s._v("\n比如, "),t("code",[s._v("umask 003")]),s._v(" , 如果以数字加减, 则文件权限为 "),t("code",[s._v("666-003=663")]),s._v(" , 相当于 "),t("code",[s._v("-rw-rw--wx")]),s._v(" , 显然不正确, 应该先转换成权限属性再相减 "),t("code",[s._v("-rw-rw-rw-")]),s._v(" 减去 "),t("code",[s._v("--------wx")]),s._v(" , 即应该为 "),t("code",[s._v("-rw-rw-r--")]),s._v(" "),t("br"),s._v("\n影响: 移动规范要求 "),t("code",[s._v("umask 027")]),s._v(" , 这样生成的文件默认权限为 "),t("code",[s._v("-rw-r-----")]),s._v(" , 只有本用户可读、写、执行。如果业务需要, 其他用户也需要操作该 用户的文件, 就会有问题。可以使用默认的 "),t("code",[s._v("022")])])]),s._v(" "),t("h2",{attrs:{id:"环境变量的安全性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境变量的安全性"}},[s._v("#")]),s._v(" 环境变量的安全性")]),s._v(" "),t("h3",{attrs:{id:"root-用户环境变量的安全性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#root-用户环境变量的安全性"}},[s._v("#")]),s._v(" root 用户环境变量的安全性")]),s._v(" "),t("p",[s._v("主要检查 "),t("code",[s._v("PATH")]),s._v(" 变量, "),t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(^|:)(\\.|:|$)'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/redhat-reinforce-12.png",alt:"RedHat 安全加固"}})]),s._v(" "),t("p",[s._v("检查是否包含组目录权限为 "),t("code",[s._v("o+w")]),s._v(" 的目录或者 "),t("code",[s._v("g+w")]),s._v(" 的目录")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tr")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' '")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" -type d "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" -perm -002 -o -perm -020 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -ls\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("-002")]),s._v(" 表示任何目录或文件, 只要带 "),t("code",[s._v("o+w")]),s._v(" 就匹配")]),s._v(" "),t("li",[t("code",[s._v("+002")]),s._v(" 表示目录或文件只有 "),t("code",[s._v("o+w")]),s._v(" 权限, 即 "),t("code",[s._v("-------w-")])])]),s._v(" "),t("p",[s._v("可能会出现报错提示 "),t("code",[s._v("/root/bin")]),s._v(" 目录不存在, "),t("code",[s._v("PATH")]),s._v(" 里有该路径, 而实际上没有, 可以先在 "),t("code",[s._v("/root")]),s._v(" 下建立一个 "),t("code",[s._v("bin")]),s._v(" 目录")]),s._v(" "),t("h3",{attrs:{id:"检查-root-用户环境变量-path-规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查-root-用户环境变量-path-规范"}},[s._v("#")]),s._v(" 检查 root 用户环境变量 path 规范")]),s._v(" "),t("p",[s._v("检查系统 root 用户环境变量 path 中是否包含 "),t("code",[s._v("“.”")]),s._v(" , "),t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("修改文件 "),t("code",[s._v("/etc/profile")]),s._v(" 、 "),t("code",[s._v("/etc/bashrc")]),s._v(" 或 "),t("code",[s._v("/root/.bash_profile")]),s._v(" 在 "),t("code",[s._v("“PATH＝……”")]),s._v(" 这句中删除")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("-002")]),s._v(" 表示任何目录或文件, 只要带 "),t("code",[s._v("o+w")]),s._v(" 就匹配")]),s._v(" "),t("li",[t("code",[s._v("+002")]),s._v(" 表示目录或文件只有 "),t("code",[s._v("o+w")]),s._v(" 权限, 即 "),t("code",[s._v("-------w-")])])]),s._v(" "),t("p",[s._v("可能会出现报错提示 "),t("code",[s._v("/root/bin")]),s._v(" 目录不存在, "),t("code",[s._v("PATH")]),s._v(" 里有该路径, 而实际上没有, 可以先在 "),t("code",[s._v("/root")]),s._v(" 下建立一个 "),t("code",[s._v("bin")]),s._v(" 目录")]),s._v(" "),t("h2",{attrs:{id:"远程连接的安全性配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#远程连接的安全性配置"}},[s._v("#")]),s._v(" 远程连接的安全性配置")]),s._v(" "),t("p",[s._v("主要查找系统中是否含有 "),t("code",[s._v(".netrc")]),s._v(" 和 "),t("code",[s._v(".rhosts")]),s._v(" 文件, 如无必要, 删除这两个文件, "),t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -name .netrc\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -name .rhosts\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"重要目录和文件的权限设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重要目录和文件的权限设置"}},[s._v("#")]),s._v(" 重要目录和文件的权限设置")]),s._v(" "),t("p",[s._v("执行以下命令检查目录和文件的权限设置情况")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/rc.d/init.d/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /tmp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/inetd.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/passwd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/shadow\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/group\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/security\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/services\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/rc*.d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("对于重要目录, 建议执行如下类似操作, "),t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("750")]),s._v(" /etc/rc.d/init.d/*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这样只有 root 可以读、写和执行, 编写脚本一次性执行, "),t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /etc/passwd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/shadow\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /etc/group\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/gshadow\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" /bin/rpm\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /usr/bin/xhost\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("664")]),s._v(" /etc/hosts\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /etc/exports\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /etc/issue\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("664")]),s._v(" /var/log/wtmp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /etc/services\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("  /etc/xinetd.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/login.defs\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/hosts.allow\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/hosts.deny\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/securetty\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/ssh/ssh_host_key\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/ssh/sshd_config\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /var/log/lastlog\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /var/log/messages\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/security\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("影响:  有的移动安全加固标准要求/etc 目录是 750 权限, 但如果/etc 目录是权限是 750（drwxr-x---）的话, 由于其他组没有 x 权限, 那么普通用户就无权访问/etc 目录以及以下所有文件, 用户获取不到基本的环境变量/etc/profile 和/etc/passwd、group 等文件, 一些基本命令都会出现问题, 本用户的文件只有 uid、gid, 无法对应名用户名称和组名称。")])]),s._v(" "),t("h2",{attrs:{id:"检查任何人都有写权限的目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查任何人都有写权限的目录"}},[s._v("#")]),s._v(" 检查任何人都有写权限的目录")]),s._v(" "),t("p",[t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -type d -perm -0222 -exec "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -ldg "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/redhat-reinforce-13.png",alt:"RedHat 安全加固"}})]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("这些目录是存放每个用户临时文件的, 目录本身是带 "),t("code",[s._v("Sticky BIT")]),s._v(" 粘滞位的, 即使里面的文件有 "),t("code",[s._v("o+w")]),s._v(" 权限也没问题, 系统本身有保护性措施。")])]),s._v(" "),t("h2",{attrs:{id:"查找任何人都有写权限的文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查找任何人都有写权限的文件"}},[s._v("#")]),s._v(" 查找任何人都有写权限的文件")]),s._v(" "),t("p",[t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -type f -perm -0222 -exec "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -lg "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/redhat-reinforce-14.png",alt:"RedHat 安全加固"}})]),s._v(" "),t("h2",{attrs:{id:"检查没有属主的文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查没有属主的文件"}},[s._v("#")]),s._v(" 检查没有属主的文件")]),s._v(" "),t("p",[t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -nouser -o -nogroup -print\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("发现没有属主的文件往往就意味着有黑客入侵你的系统了。不能允许没有主 人的文件存在。如果在系统中发现了没有属主的文件或目录, 先查看它的完 整性, 如果一切正常, 给它一个属主。有时候卸载程序可能会出现一些没有 主人的文件或目录, 在这种情况下可以把这些文件和目录删除掉。")]),s._v(" "),t("p",[s._v("在安全加固脚本中, 把没有属主或属组的文件直接赋予了 "),t("code",[s._v("nobody")]),s._v(" 用户和组, "),t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -path "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/proc"')]),s._v(" -prune -nouser -o -nogroup -exec "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" nobody:nobody "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("命令中排除了 /proc 目录")])]),s._v(" "),t("h2",{attrs:{id:"检查异常隐含文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查异常隐含文件"}},[s._v("#")]),s._v(" 检查异常隐含文件")]),s._v(" "),t("p",[t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -xdev -name "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"..*"')]),s._v(" -print\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -xdev -name "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"...*"')]),s._v(" -print\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -xdev -name "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"..^G"')]),s._v(" -print\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("同时也要注意象 "),t("code",[s._v("“.xx”")]),s._v(" 和 "),t("code",[s._v("“.mail”")]),s._v(" 这样的文件名的。（这些文件名看起来都很象正常的文件名）在系统的每个地方都要查看一下有没有异常隐含文件（点号是起始字符的, 用 "),t("code",[s._v("“ls”")]),s._v(" 命令看不到的文件）, 因为这些文件可能是隐藏的黑客工具或者其它一些信息（口令破解程序、其它系统的口令文件, 等等）。在 "),t("code",[s._v("UNIX")]),s._v(" 下, 一个常用的技术就是用一些特殊的名, 如: "),t("code",[s._v("“...”")]),s._v(" 、 "),t("code",[s._v("“.. ”（点点空格")]),s._v(" ）或 "),t("code",[s._v("“..^G”（点点 ctrl+v 和 ctrl+G）")]),s._v(" , 来隐含文件或目录。")]),s._v(" "),t("p",[s._v("基本上系统默认只有一个文件 "),t("code",[s._v("/usr/share/man/man1/..1.gz")]),s._v(" , 在加固脚本中的处理方式是存在就直接把它删除掉。"),t("br")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://oss-blog.test.upcdn.net/redhat-reinforce-15.png",alt:"RedHat 安全加固"}})]),s._v(" "),t("h2",{attrs:{id:"加锁重要口令文件和组文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加锁重要口令文件和组文件"}},[s._v("#")]),s._v(" 加锁重要口令文件和组文件")]),s._v(" "),t("p",[s._v("可以用下面的命令给口令文件和组文件设置不可改变位加锁, "),t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("chattr +i /etc/passwd\nchattr +i /etc/shadow\nchattr +i /etc/group\nchattr +i /etc/gshadow\nchattr +i /etc/xinetd.conf\nchattr +i /etc/services\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("加锁后, 就不能被改变文件内容。同时会影响 "),t("code",[s._v("useradd")]),s._v(" 、 "),t("code",[s._v("userdel")]),s._v(" 等跟帐户相关的操作")]),s._v(" "),t("p",[s._v("查看命令, "),t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("lsattr /etc/passwd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("返回结果为: "),t("code",[s._v("----i-------- /etc/passwd")])]),s._v(" "),t("p",[s._v("如果要修改文件, 必须先对该文件进行解锁, "),t("code",[s._v("For Exmaple:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("chattr -i /etc/passwd\nchattr -i /etc/shadow\nchattr -i /etc/group\nchattr -i /etc/gshadow\nchattr -i /etc/xinetd.conf\nchattr -i /etc/services\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);